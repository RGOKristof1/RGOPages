<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Text Saver</title>
</head>
<body>

    <h2>Data Saver</h2>

    <!-- Token státusz kijelző -->
    <p id="tokenStatus"></p>

    <!-- Gomb a token bekéréséhez -->
    <button id="setTokenBtn">Set GitHub Token</button>
    <br><br>

    <!-- Szövegmező a menteni kívánt tartalomhoz -->
    <textarea id="textInput" rows="10" cols="50" placeholder="Írd ide a menteni kívánt szöveget..."></textarea>
    <br><br>

    <!-- Mentés gomb -->
    <button id="saveBtn">Save</button>

    <p id="status"></p>

    <script>
        // ***** Állítsd be a GitHub felhasználónevedet *****
        const username = "YOUR_USERNAME_HERE";  // <-- ezt írd át!


        //-------------------------------------------------------
        // Token kezelés - kérés, mentés, státusz ellenőrzés
        //-------------------------------------------------------

        // Státusz kijelzés tokenről
        function updateTokenStatus() {
            const token = localStorage.getItem("github_token");
            const ts = document.getElementById("tokenStatus");

            if (token) {
                ts.textContent = "Token loaded (saved locally).";
            } else {
                ts.textContent = "No token set! Click 'Set GitHub Token'.";
            }
        }

        // Token bekérés és mentése localStorage-be
        document.getElementById("setTokenBtn").addEventListener("click", () => {
            const token = prompt("Add meg a GitHub Personal Access Token-t:");

            if (token && token.trim() !== "") {
                localStorage.setItem("github_token", token.trim());
                updateTokenStatus();
                alert("Token saved!");
            } else {
                alert("Token not saved.");
            }
        });

        updateTokenStatus();


        //-------------------------------------------------------
        // MENTÉS gomb - Workflow indítása
        //-------------------------------------------------------
        document.getElementById("saveBtn").addEventListener("click", async () => {
            const text = document.getElementById("textInput").value;
            const token = localStorage.getItem("github_token");
            const status = document.getElementById("status");

            // Ha nincs token – nincs értelme menteni
            if (!token) {
                status.textContent = "Error: No token set!";
                return;
            }

            status.textContent = "Saving...";

            try {
                const response = await fetch(
                    `https://api.github.com/repos/${username}/rgopages.hu/actions/workflows/update-text.yml/dispatches`,
                    {
                        method: "POST",
                        headers: {
                            "Accept": "application/vnd.github+json",
                            "Authorization": `token ${token}`
                        },
                        body: JSON.stringify({
                            ref: "main",
                            inputs: {
                                newtext: text
                            }
                        })
                    }
                );

                if (response.ok) {
                    status.textContent = "Saved! Workflow started.";
                    document.getElementById("textInput").value = ""; // mező törlése
                } else {
                    status.textContent = "Error! Can't start workflow.";
                    console.error(await response.text());
                }

            } catch (err) {
                status.textContent = "Network error!";
                console.error(err);
            }
        });
    </script>
</body>
</html>
